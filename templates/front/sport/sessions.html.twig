{# BioSync Sport Module - Sessions List
# Front Office - Sport Management
#}

{% extends 'front/base.html.twig' %}

{% block title %}Sport - BioSync{% endblock %}

{% block content %}
<div class="container py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 font-heading mb-2">
                    Sport & Activité
                </h1>
                <p class="text-gray-600">
                    Suivez vos séances et progressez vers vos objectifs fitness
                </p>
            </div>
            <div class="mt-4 md:mt-0 flex gap-3">
                {% include 'components/_button.html.twig' with {
                    'text': 'Nouvelle séance',
                    'variant': 'primary',
                    'icon': 'fas fa-plus',
                    'onclick': 'openModal_sessionModal()'
                } %}
                {% include 'components/_button.html.twig' with {
                    'text': 'Programmes',
                    'variant': 'outline',
                    'icon': 'fas fa-list'
                } %}
            </div>
        </div>
    </div>

    <!-- Weekly Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        {% include 'components/_kpi_card.html.twig' with {
            'value': '4',
            'label': 'Séances cette semaine',
            'trend': {
                'value': '+1',
                'direction': 'up',
                'color': 'success'
            },
            'icon': 'fas fa-dumbbell',
            'size': 'sm'
        } %}
        
        {% include 'components/_kpi_card.html.twig' with {
            'value': '185',
            'label': 'Minutes d\'activité',
            'trend': {
                'value': '+25',
                'direction': 'up',
                'color': 'success'
            },
            'icon': 'fas fa-clock',
            'size': 'sm'
        } %}
        
        {% include 'components/_kpi_card.html.twig' with {
            'value': '2,450',
            'label': 'Calories brûlées',
            'trend': {
                'value': '+320',
                'direction': 'up',
                'color': 'success'
            },
            'icon': 'fas fa-fire',
            'size': 'sm'
        } %}
        
        {% include 'components/_kpi_card.html.twig' with {
            'value': '12',
            'label': 'Jours consécutifs',
            'icon': 'fas fa-calendar-check',
            'size': 'sm'
        } %}
    </div>

    <!-- Monthly Calories Chart -->
    {% include 'components/_card.html.twig' with {
        'title': 'Calories Brûlées - Ce Mois',
        'variant': 'default'
    } %}
    {% block card_body %}
        <div class="chart-placeholder">
            <div class="text-center">
                <i class="fas fa-chart-bar text-4xl text-blue-400 mb-3"></i>
                <p>Graphique des calories brûlées ce mois</p>
                <div class="mt-4 flex justify-center gap-4 text-sm">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span>Ce mois: 8,450 cal</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                        <span>Objectif: 10,000 cal</span>
                    </div>
                </div>
            </div>
        </div>
    {% endblock %}
    {% endinclude %}

    <!-- Exercise Recommendations -->
    {% include 'components/_card.html.twig' with {
        'title': 'Recommandations du Jour',
        'subtitle': 'Basées sur votre profil et vos objectifs',
        'variant': 'soft'
    } %}
    {% block card_body %}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-4 bg-white rounded-lg border border-gray-200">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-running text-blue-500"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">Cardio</h4>
                        <p class="text-sm text-gray-600">30 min modéré</p>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-3">
                    Course légère ou vélo pour améliorer votre endurance.
                </p>
                {% include 'components/_button.html.twig' with {
                    'text': 'Commencer',
                    'variant': 'soft',
                    'size': 'sm',
                    'class': 'w-full'
                } %}
            </div>
            
            <div class="p-4 bg-white rounded-lg border border-gray-200">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-dumbbell text-green-500"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">Musculation</h4>
                        <p class="text-sm text-gray-600">45 min intense</p>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-3">
                    Haut du corps: pectoraux, dos, épaules.
                </p>
                {% include 'components/_button.html.twig' with {
                    'text': 'Commencer',
                    'variant': 'soft',
                    'size': 'sm',
                    'class': 'w-full'
                } %}
            </div>
            
            <div class="p-4 bg-white rounded-lg border border-gray-200">
                <div class="flex items-center mb-3">
                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-spa text-purple-500"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">Flexibilité</h4>
                        <p class="text-sm text-gray-600">15 min doux</p>
                    </div>
                </div>
                <p class="text-sm text-gray-600 mb-3">
                    Étirements et yoga pour la récupération.
                </p>
                {% include 'components/_button.html.twig' with {
                    'text': 'Commencer',
                    'variant': 'soft',
                    'size': 'sm',
                    'class': 'w-full'
                } %}
            </div>
        </div>
    {% endblock %}
    {% endinclude %}

    <!-- Recent Sessions -->
    <div class="mt-8">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900">Séances Récentes</h2>
            <div class="flex gap-2">
                <button class="btn btn-soft btn-sm" onclick="filterSessions('all')">Tout</button>
                <button class="btn btn-soft btn-sm" onclick="filterSessions('cardio')">Cardio</button>
                <button class="btn btn-soft btn-sm" onclick="filterSessions('strength')">Musculation</button>
                <button class="btn btn-soft btn-sm" onclick="filterSessions('flexibility')">Flexibilité</button>
            </div>
        </div>

        <div class="space-y-4">
            <!-- Today's Session -->
            {% include 'components/_card.html.twig' with {
                'title': 'Aujourd\'hui',
                'subtitle': '2 séances programmées'
            } %}
            {% block card_body %}
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-running text-green-500 text-lg"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">Cardio - Course</h4>
                                <p class="text-sm text-gray-600">08:00 - 08:45 • 45 minutes</p>
                                <div class="flex items-center gap-4 mt-1">
                                    <span class="text-sm text-gray-500">
                                        <i class="fas fa-fire text-orange-500"></i> 320 cal
                                    </span>
                                    <span class="text-sm text-gray-500">
                                        <i class="fas fa-route text-blue-500"></i> 6.5 km
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="badge badge-success">Terminé</span>
                            <button class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-dumbbell text-blue-500 text-lg"></i>
                            </div>
                            <div>
                                <h4 class="font-medium">Musculation - Haut du corps</h4>
                                <p class="text-sm text-gray-600">18:00 - 18:45 • 45 minutes</p>
                                <div class="flex items-center gap-4 mt-1">
                                    <span class="text-sm text-gray-500">
                                        <i class="fas fa-fire text-orange-500"></i> 280 cal
                                    </span>
                                    <span class="text-sm text-gray-500">
                                        <i class="fas fa-weight text-purple-500"></i> 8 exercices
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="badge badge-info">À venir</span>
                            <button class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
            {% endblock %}
            {% endinclude %}

            <!-- Yesterday's Sessions -->
            {% include 'components/_card.html.twig' with {
                'title': 'Hier',
                'subtitle': '1 séance'
            } %}
            {% block card_body %}
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-spa text-purple-500 text-lg"></i>
                        </div>
                        <div>
                            <h4 class="font-medium">Yoga - Flow doux</h4>
                            <p class="text-sm text-gray-600">07:30 - 08:00 • 30 minutes</p>
                            <div class="flex items-center gap-4 mt-1">
                                <span class="text-sm text-gray-500">
                                    <i class="fas fa-fire text-orange-500"></i> 120 cal
                                </span>
                                <span class="text-sm text-gray-500">
                                    <i class="fas fa-heart text-red-500"></i> 95 bpm moyen
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="badge badge-success">Terminé</span>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
            {% endblock %}
            {% endinclude %}

            <!-- This Week -->
            {% include 'components/_card.html.twig' with {
                'title': 'Cette Semaine',
                'subtitle': '4 séances terminées'
            } %}
            {% block card_body %}
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-bicycle text-blue-500"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-sm">Vélo - Intervalle</h4>
                                <p class="text-xs text-gray-600">Lundi • 35 min • 280 cal</p>
                            </div>
                        </div>
                        <span class="badge badge-success text-xs">Terminé</span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-running text-green-500"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-sm">Course - Endurance</h4>
                                <p class="text-xs text-gray-600">Mardi • 50 min • 450 cal</p>
                            </div>
                        </div>
                        <span class="badge badge-success text-xs">Terminé</span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-dumbbell text-purple-500"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-sm">Musculation - Bas du corps</h4>
                                <p class="text-xs text-gray-600">Mercredi • 40 min • 320 cal</p>
                            </div>
                        </div>
                        <span class="badge badge-success text-xs">Terminé</span>
                    </div>
                </div>
            {% endblock %}
            {% endinclude %}
        </div>
    </div>

    <!-- Goals Progress -->
    {% include 'components/_card.html.twig' with {
        'title': 'Objectifs du Mois',
        'variant': 'default'
    } %}
    {% block card_body %}
        <div class="space-y-4">
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span class="font-medium">Séances totales</span>
                    <span class="text-sm text-gray-600">12 / 20</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-500 h-2 rounded-full" style="width: 60%"></div>
                </div>
            </div>
            
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span class="font-medium">Calories brûlées</span>
                    <span class="text-sm text-gray-600">8,450 / 10,000</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-green-500 h-2 rounded-full" style="width: 84.5%"></div>
                </div>
            </div>
            
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span class="font-medium">Minutes d'activité</span>
                    <span class="text-sm text-gray-600">485 / 600</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-purple-500 h-2 rounded-full" style="width: 80.8%"></div>
                </div>
            </div>
        </div>
    {% endblock %}
    {% endinclude %}
</div>

<!-- Add Session Modal -->
{% include 'components/_modal.html.twig' with {
    'id': 'sessionModal',
    'title': 'Nouvelle Séance',
    'size': 'lg'
} %}
{% block modal_content %}
    {% include 'components/_form.html.twig' with {
        'action': path('app_sport_add_session'),
        'method': 'POST',
        'fields': [
            {
                'name': 'session_type',
                'type': 'select',
                'label': 'Type de séance',
                'required': true,
                'options': [
                    {'value': 'cardio', 'label': 'Cardio'},
                    {'value': 'strength', 'label': 'Musculation'},
                    {'value': 'flexibility', 'label': 'Flexibilité/Yoga'},
                    {'value': 'sports', 'label': 'Sports'},
                    {'value': 'other', 'label': 'Autre'}
                ]
            },
            {
                'name': 'session_name',
                'type': 'text',
                'label': 'Nom de la séance',
                'placeholder': 'Ex: Course matinale, Haut du corps...',
                'required': true
            },
            {
                'name': 'duration',
                'type': 'text',
                'label': 'Durée (minutes)',
                'placeholder': '45',
                'required': true
            },
            {
                'name': 'intensity',
                'type': 'select',
                'label': 'Intensité',
                'required': true,
                'options': [
                    {'value': 'low', 'label': 'Léger'},
                    {'value': 'moderate', 'label': 'Modéré'},
                    {'value': 'high', 'label': 'Intense'},
                    {'value': 'very_high', 'label': 'Très intense'}
                ]
            },
            {
                'name': 'calories_burned',
                'type': 'text',
                'label': 'Calories brûlées (estimation)',
                'placeholder': '300',
                'help': 'Laissez vide pour calcul automatiquement'
            },
            {
                'name': 'notes',
                'type': 'textarea',
                'label': 'Notes (optionnel)',
                'placeholder': 'Exercices réalisés, sensations, objectifs...'
            }
        ],
        'submit_text': 'Démarrer la séance',
        'submit_variant': 'primary'
    } %}
{% endblock %}
{% endmodal_content %}
{% endinclude %}
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize session filtering
    initializeSessionFiltering();
    
    // Initialize session actions
    initializeSessionActions();
    
    // Update real-time stats
    updateRealTimeStats();
});

function initializeSessionFiltering() {
    window.filterSessions = function(type) {
        const allSessions = document.querySelectorAll('.space-y-3 > div');
        
        allSessions.forEach(session => {
            if (type === 'all') {
                session.style.display = 'flex';
            } else {
                // This would filter based on session type
                // For demo, we'll just show/hide randomly
                const sessionType = getSessionType(session);
                session.style.display = sessionType === type ? 'flex' : 'none';
            }
        });
        
        // Update button states
        document.querySelectorAll('.btn-soft').forEach(btn => {
            btn.classList.remove('bg-blue-500', 'text-white');
        });
        event.target.classList.add('bg-blue-500', 'text-white');
    };
}

function getSessionType(sessionElement) {
    const title = sessionElement.querySelector('h4').textContent.toLowerCase();
    if (title.includes('cardio') || title.includes('course') || title.includes('vélo')) return 'cardio';
    if (title.includes('musculation') || title.includes('dumbbell')) return 'strength';
    if (title.includes('yoga') || title.includes('flexibilité')) return 'flexibility';
    return 'other';
}

function initializeSessionActions() {
    // Session menu actions
    document.querySelectorAll('.fa-ellipsis-v').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            showSessionContextMenu(this);
        });
    });
    
    // Start session buttons
    document.querySelectorAll('.badge.badge-info').forEach(badge => {
        badge.addEventListener('click', function() {
            if (this.textContent === 'À venir') {
                startSession(this);
            }
        });
    });
}

function showSessionContextMenu(button) {
    const menu = document.createElement('div');
    menu.className = 'absolute bg-white border border-gray-200 rounded-lg shadow-lg py-2 z-50';
    menu.innerHTML = `
        <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
            <i class="fas fa-play mr-2"></i> Démarrer
        </button>
        <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
            <i class="fas fa-edit mr-2"></i> Modifier
        </button>
        <button class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
            <i class="fas fa-chart-line mr-2"></i> Voir détails
        </button>
        <button class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">
            <i class="fas fa-trash mr-2"></i> Supprimer
        </button>
    `;
    
    const rect = button.getBoundingClientRect();
    menu.style.top = rect.bottom + 'px';
    menu.style.left = rect.left + 'px';
    
    document.body.appendChild(menu);
    
    setTimeout(() => {
        document.addEventListener('click', function closeMenu() {
            menu.remove();
            document.removeEventListener('click', closeMenu);
        });
    }, 100);
}

function startSession(badge) {
    // Show confirmation modal
    if (confirm('Êtes-vous prêt à commencer cette séance ?')) {
        // This would start the session timer
        showAlert('Séance démarrée ! Bon courage !', 'success');
        badge.textContent = 'En cours';
        badge.className = 'badge badge-warning';
    }
}

function updateRealTimeStats() {
    // Simulate real-time updates
    setInterval(() => {
        // Update consecutive days
        const daysElement = document.querySelector('.kpi-value');
        if (daysElement && daysElement.textContent.includes('Jours')) {
            // This would calculate from actual data
        }
    }, 60000); // Update every minute
}

// Form validation for session creation
document.addEventListener('DOMContentLoaded', function() {
    const sessionForm = document.querySelector('#sessionModal form');
    if (sessionForm) {
        sessionForm.addEventListener('submit', function(e) {
            const duration = document.querySelector('input[name="duration"]').value;
            const intensity = document.querySelector('select[name="intensity"]').value;
            
            if (!duration || duration < 5) {
                e.preventDefault();
                showAlert('La durée doit être d\'au moins 5 minutes', 'error');
                return;
            }
            
            // Estimate calories if not provided
            const caloriesInput = document.querySelector('input[name="calories_burned"]');
            if (!caloriesInput.value) {
                const estimatedCalories = estimateCalories(duration, intensity);
                caloriesInput.value = estimatedCalories;
            }
        });
    }
});

function estimateCalories(duration, intensity) {
    // Simple calorie estimation based on duration and intensity
    const baseCalories = {
        'low': 5,
        'moderate': 8,
        'high': 12,
        'very_high': 15
    };
    
    return Math.round(duration * (baseCalories[intensity] || 8));
}
</script>
{% endblock %}
