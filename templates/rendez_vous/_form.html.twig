<div class="rdv-form-container">

<h3 class="section-title">Informations du rendez-vous</h3>

{{ form_start(form) }}

<div class="form-grid">

    <div class="form-field full">
        {{ form_label(form.specialiste) }}
        {{ form_widget(form.specialiste) }}
    </div>

    <div class="form-field half">
        {{ form_label(form.dateHeure) }}
        {{ form_widget(form.dateHeure) }}
    </div>

    <div class="form-field half">
        {{ form_label(form.mode) }}
        {{ form_widget(form.mode) }}
    </div>

    <div class="form-field full">
        {{ form_label(form.motif) }}
        {{ form_widget(form.motif) }}
    </div>

</div>

<button class="btn btn-primary mt-4">
    {{ button_label|default('Confirmer le rendez-vous') }}
</button>

{{ form_end(form) }}

</div>

<style>
.ai-suggestions {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
}
.ai-loading {
    display: none;
    color: #007bff;
    font-style: italic;
}
.btn-ai {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
}
.btn-ai:hover {
    background: #0056b3;
}
.urgency-high {
    border-left: 5px solid #dc3545;
    background: #f8d7da;
}
.urgency-medium {
    border-left: 5px solid #ffc107;
    background: #fff3cd;
}
.urgency-low {
    border-left: 5px solid #28a745;
    background: #d4edda;
}
</style>

<script>
function analyzeUrgency() {
    const motif = document.querySelector('[name*="[motif]"]').value;
    
    if (!motif.trim()) {
        alert('Veuillez d\'abord entrer le motif du rendez-vous');
        return;
    }
    
    document.getElementById('triage-loading').style.display = 'block';
    document.getElementById('triage-result').style.display = 'none';
    
    // For demo, use a temporary rendez-vous ID (in real app, this would be after form submission)
    const tempRdvId = 0;
    
    fetch('/api/ai/predict-emergency', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            reason: motif,
            rendezVousId: tempRdvId
        })
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('triage-loading').style.display = 'none';
        
        if (data.success) {
            displayTriageResult(data);
        } else {
            document.getElementById('triage-result').innerHTML = 
                '<p style="color: red;">Erreur: ' + data.error + '</p>';
            document.getElementById('triage-result').style.display = 'block';
        }
    })
    .catch(error => {
        document.getElementById('triage-loading').style.display = 'none';
        document.getElementById('triage-result').innerHTML = 
            '<p style="color: red;">Erreur: ' + error.message + '</p>';
        document.getElementById('triage-result').style.display = 'block';
    });
}

function displayTriageResult(data) {
    let urgencyClass = 'urgency-low';
    if (data.emergencyLevel >= 8) {
        urgencyClass = 'urgency-high';
    } else if (data.emergencyLevel >= 5) {
        urgencyClass = 'urgency-medium';
    }
    
    let html = `
        <div class="${urgencyClass}" style="padding: 15px; border-radius: 8px;">
            <h4>ðŸš¨ Analyse d'urgence IA</h4>
            <p><strong>Niveau d'urgence:</strong> ${data.emergencyLevel}/10</p>
            <p><strong>Message:</strong> ${data.message}</p>
            <p><strong>Confiance:</strong> ${Math.round((data.triageData.confidence || 0) * 100)}%</p>
        </div>
    `;
    
    document.getElementById('triage-result').innerHTML = html;
    document.getElementById('triage-result').style.display = 'block';
}
</script>