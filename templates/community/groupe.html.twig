{% extends 'base.html.twig' %}

{% block title %}{{ groupe.nomGroupe }} - BioSync{% endblock %}

{% block body %}
<div class="app-layout">
    {% include 'partials/_sidebar.html.twig' with {'active': 'community'} %}

    <main class="main-content">
        <div class="page-header flex-between">
            <div>
                <h1 class="page-title">{{ groupe.nomGroupe }}</h1>
                <p class="page-subtitle">{{ groupe.thematique }}</p>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                {% if isMember %}
                    <form action="{{ path('app_community_leave', {id: groupe.id}) }}" method="post">
                        <input type="hidden" name="_token" value="{{ csrf_token('leave' ~ groupe.id) }}">
                        <button type="submit" class="btn btn-danger">Quitter le groupe</button>
                    </form>
                {% elseif groupe.hasPlaceDisponible %}
                    <form action="{{ path('app_community_join', {id: groupe.id}) }}" method="post">
                        <input type="hidden" name="_token" value="{{ csrf_token('join' ~ groupe.id) }}">
                        <button type="submit" class="btn btn-primary">Rejoindre le groupe</button>
                    </form>
                {% endif %}
                <a href="{{ path('app_community') }}" class="btn btn-ghost">Retour</a>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Informations</h4>
                </div>
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-subtitle">Thematique</div>
                        <div class="list-item-title">
                            <span class="badge badge-primary">{{ groupe.thematique }}</span>
                        </div>
                    </div>
                </div>
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-subtitle">Membres</div>
                        <div class="list-item-title">{{ groupe.nombreMembres }} / {{ groupe.capaciteMax }}</div>
                    </div>
                </div>
                {% if groupe.description %}
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-subtitle">Description</div>
                        <div class="list-item-title">{{ groupe.description }}</div>
                    </div>
                </div>
                {% endif %}
                {% if isMember %}
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-subtitle">Votre role</div>
                        <div class="list-item-title">
                            <span class="badge badge-secondary">{{ membership.roleMembre }}</span>
                        </div>
                    </div>
                </div>
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-subtitle">Membre depuis</div>
                        <div class="list-item-title">{{ membership.dateAdhesion|date('d/m/Y') }}</div>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Evenements ({{ groupe.evenements|length }})</h4>
                </div>
                {% if groupe.evenements|length > 0 %}
                    {% for event in groupe.evenements %}
                        <div class="list-item">
                            <div class="list-item-icon" style="background: {{ event.isUpcoming ? 'rgba(54, 124, 254, 0.1)' : 'rgba(156, 163, 175, 0.1)' }}; color: {{ event.isUpcoming ? 'var(--secondary)' : 'var(--gray-400)' }};">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                </svg>
                            </div>
                            <div class="list-item-content">
                                <div class="list-item-title">{{ event.titreEvent }}</div>
                                <div class="list-item-subtitle">{{ event.dateEvent|date('d/m/Y H:i') }}</div>
                            </div>
                            {% if event.isUpcoming %}
                                <span class="badge badge-success">{{ event.pointsParticipation }} pts</span>
                            {% else %}
                                <span class="badge badge-secondary">Passe</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <p class="text-gray">Aucun evenement pour ce groupe</p>
                    </div>
                {% endif %}
            </div>
        </div>

        {# Membres du groupe #}
        <div class="card mt-6">
            <div class="card-header">
                <h4 class="card-title">Membres ({{ groupe.membres|length }})</h4>
            </div>
            {% if groupe.membres|length > 0 %}
                <div class="grid grid-cols-4 gap-4">
                    {% for membre in groupe.membres %}
                        <div class="list-item">
                            <div class="sidebar-user-avatar" style="width: 40px; height: 40px; font-size: 0.875rem;">
                                {{ membre.utilisateur.initials }}
                            </div>
                            <div class="list-item-content">
                                <div class="list-item-title">{{ membre.utilisateur.nomComplet }}</div>
                                <div class="list-item-subtitle">{{ membre.roleMembre }}</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p class="text-gray">Aucun membre dans ce groupe</p>
                </div>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
